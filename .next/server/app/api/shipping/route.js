"use strict";(()=>{var e={};e.id=5528,e.ids=[5528],e.modules={96330:e=>{e.exports=require("@prisma/client")},10846:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},12412:e=>{e.exports=require("assert")},79428:e=>{e.exports=require("buffer")},55511:e=>{e.exports=require("crypto")},94735:e=>{e.exports=require("events")},81630:e=>{e.exports=require("http")},55591:e=>{e.exports=require("https")},11723:e=>{e.exports=require("querystring")},79551:e=>{e.exports=require("url")},28354:e=>{e.exports=require("util")},74075:e=>{e.exports=require("zlib")},40946:(e,r,t)=>{t.r(r),t.d(r,{patchFetch:()=>D,routeModule:()=>w,serverHooks:()=>O,workAsyncStorage:()=>b,workUnitAsyncStorage:()=>E});var s={};t.r(s),t.d(s,{GET:()=>m,POST:()=>y});var i=t(42706),n=t(28203),a=t(45994),o=t(51825),u=t(15716),d=t(84574),p=t(35743),l=t(65287),c=t(74559),h=t(71018),f=t(67939);let m=(0,p.Rq)({rateLimiter:l.bO,handler:async e=>{let r=await (0,o.getServerSession)(u.Nh);if(!r?.user?.id)return p.sh.unauthorized();let{searchParams:t}=new URL(e.url),s=t.get("orderId");if(!s)return h.Ay.info("Shipping methods fetched",{userId:r.user.id}),p.sh.success({shippingMethods:[{id:"standard",name:"Standard Delivery",description:"5-7 business days",price:500,estimatedDays:7},{id:"express",name:"Express Delivery",description:"2-3 business days",price:1e3,estimatedDays:3},{id:"overnight",name:"Overnight Delivery",description:"Next business day",price:2e3,estimatedDays:1},{id:"pickup",name:"Store Pickup",description:"Pick up from our store",price:0,estimatedDays:0}]});{let e=Date.now(),t=await d.zR.order.findUnique({where:{id:s},include:{shippingAddress:!0,items:{include:{product:{include:{images:!0}}}}}});if(!t)return p.sh.notFound("Order not found");let i={orderId:t.id,status:t.status,trackingNumber:t.trackingNumber,shippingMethod:t.shippingMethod||"Standard Delivery",estimatedDelivery:v(t.createdAt,t.shippingMethod),shippingAddress:t.shippingAddress,items:t.items,timeline:function(e){let r=[{status:"Order Placed",date:e.createdAt,completed:!0,description:"Your order has been received and is being processed"}];if(("PROCESSING"===e.status||"SHIPPED"===e.status||"DELIVERED"===e.status)&&r.push({status:"Processing",date:e.createdAt,completed:!0,description:"Your order is being prepared for shipment"}),("SHIPPED"===e.status||"DELIVERED"===e.status)&&r.push({status:"Shipped",date:e.shippedAt||new Date,completed:!0,description:`Your order has been shipped via ${e.shippingMethod||"Standard Delivery"}`}),"DELIVERED"===e.status)r.push({status:"Delivered",date:e.deliveredAt||new Date,completed:!0,description:"Your order has been successfully delivered"});else{let t=v(e.createdAt,e.shippingMethod);r.push({status:"Out for Delivery",date:t,completed:!1,description:"Your order is out for delivery"})}return r}(t)},n=Date.now()-e;return h.Ay.dbQuery("order.findUnique",n,{orderId:s}),h.Ay.info("Shipping info fetched",{orderId:s,userId:r.user.id}),p.sh.success(i)}}}),g=f.Ik({orderId:f.Yj().uuid("Invalid order ID"),shippingMethod:f.Yj().min(1,"Shipping method is required"),trackingNumber:f.Yj().min(1,"Tracking number is required").optional()}),y=(0,p.Rq)({rateLimiter:l.bO,validator:(0,c.S)(g),handler:async e=>{let r=await (0,o.getServerSession)(u.Nh);if(!r?.user?.id)return p.sh.unauthorized();let{orderId:t,shippingMethod:s,trackingNumber:i}=e.validatedData,n=Date.now(),a=await d.zR.order.update({where:{id:t},data:{shippingMethod:s,trackingNumber:i,status:"SHIPPED",shippedAt:new Date}}),l=Date.now()-n;return h.Ay.dbQuery("order.update",l,{orderId:t,shippingMethod:s}),h.Ay.info("Shipping updated",{orderId:t,userId:r.user.id}),p.sh.success({order:a},"Shipping information updated successfully")}});function v(e,r){let t=new Date(e);return t.setDate(t.getDate()+(({"Standard Delivery":7,"Express Delivery":3,"Overnight Delivery":1,"Store Pickup":0})[r]||7)),t.toISOString()}let w=new i.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/shipping/route",pathname:"/api/shipping",filename:"route",bundlePath:"app/api/shipping/route"},resolvedPagePath:"/Users/user/Desktop/RogueApe/work/jabistore/src/app/api/shipping/route.js",nextConfigOutput:"",userland:s}),{workAsyncStorage:b,workUnitAsyncStorage:E,serverHooks:O}=w;function D(){return(0,a.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:E})}},13676:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0})},51825:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0});var s={};Object.defineProperty(r,"default",{enumerable:!0,get:function(){return n.default}});var i=t(13676);Object.keys(i).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(s,e))&&(e in r&&r[e]===i[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}}))});var n=function(e,r){if(e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=a(void 0);if(t&&t.has(e))return t.get(e);var s={__proto__:null},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in e)if("default"!==n&&({}).hasOwnProperty.call(e,n)){var o=i?Object.getOwnPropertyDescriptor(e,n):null;o&&(o.get||o.set)?Object.defineProperty(s,n,o):s[n]=e[n]}return s.default=e,t&&t.set(e,s),s}(t(64767));function a(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,t=new WeakMap;return(a=function(e){return e?t:r})(e)}Object.keys(n).forEach(function(e){!("default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(s,e))&&(e in r&&r[e]===n[e]||Object.defineProperty(r,e,{enumerable:!0,get:function(){return n[e]}}))})},15716:(e,r,t)=>{t.d(r,{Nh:()=>s}),t(64767);let s=t(50744).N},50744:(e,r,t)=>{t.d(r,{N:()=>u});var s=t(91642),i=t(28053),n=t(86259),a=t(34926),o=t(84574);let u={adapter:(0,n.y)(o.zR),providers:function(){let e=[(0,s.A)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){try{if(!e?.email||!e?.password)return console.error("Missing credentials"),null;let r=e.email.toLowerCase().trim(),t=await o.zR.user.findUnique({where:{email:r}});if(!t)return console.error(`User not found: ${r}`),null;if(!t.password)return console.error("User has no password (OAuth account)"),null;if(!await a.Ay.compare(e.password,t.password))return console.error("Invalid password"),null;return{id:t.id,email:t.email,name:t.name,role:t.role,image:t.avatar}}catch(e){return console.error("Authorization error:",e),null}}})];return process.env.GOOGLE_CLIENT_ID&&process.env.GOOGLE_CLIENT_SECRET?e.push((0,i.A)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET,authorization:{params:{prompt:"consent",access_type:"offline",response_type:"code"}}})):console.warn("Google OAuth not configured: GOOGLE_CLIENT_ID or GOOGLE_CLIENT_SECRET missing"),e}(),pages:{signIn:"/auth/signin"},session:{strategy:"jwt",maxAge:86400,updateAge:3600},jwt:{maxAge:86400},callbacks:{signIn:async({user:e,account:r,profile:t})=>!0,async jwt({token:e,user:r,account:t}){if(r)e.role=r.role||e.role||"USER",e.avatar=r.image||e.avatar||null,e.email=r.email;else if(!e.role&&e.sub)try{let r=await o.zR.user.findUnique({where:{id:e.sub}});r&&(e.role=r.role,e.avatar=r.avatar,e.email=r.email)}catch(e){console.error("Error fetching user for token:",e)}return e},session:async({session:e,token:r})=>(r&&e.user&&(e.user.id=r.sub,e.user.role=r.role||"USER",e.user.image=r.avatar??e.user.image??null,e.user.email=r.email??e.user.email,!e.user.id&&r.sub&&(e.user.id=r.sub)),e)},secret:process.env.NEXTAUTH_SECRET||"dilitech-dev-secret-key-2024",debug:!1}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[5994,5452,4926,126,5755,472],()=>t(40946));module.exports=s})();