(()=>{var e={};e.id=6040,e.ids=[6040],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},79551:e=>{"use strict";e.exports=require("url")},3692:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.a,__next_app__:()=>m,pages:()=>c,routeModule:()=>x,tree:()=>o});var r=t(70260),a=t(28203),i=t(25155),n=t.n(i),l=t(67292),d={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);t.d(s,d);let o=["",{children:["orders",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,78215)),"/Users/user/Desktop/RogueApe/work/jabistore/src/app/orders/[id]/page.js"]}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(t.bind(t,62804)),"/Users/user/Desktop/RogueApe/work/jabistore/src/app/layout.js"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,19937,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(t.t.bind(t,69116,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(t.t.bind(t,41485,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(t.bind(t,70440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}],c=["/Users/user/Desktop/RogueApe/work/jabistore/src/app/orders/[id]/page.js"],m={require:t,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/orders/[id]/page",pathname:"/orders/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},27145:(e,s,t)=>{Promise.resolve().then(t.bind(t,78215))},17417:(e,s,t)=>{Promise.resolve().then(t.bind(t,5699))},5699:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>b});var r=t(45512),a=t(58009),i=t(28531),n=t.n(i),l=t(79334),d=t(90993),o=t(79420),c=t(42701),m=t(6775),x=t(33319);let p={PENDING:"bg-amber-500/20 text-amber-200 border border-amber-400/30",PROCESSING:"bg-indigo-500/20 text-indigo-200 border border-indigo-400/30",SHIPPED:"bg-blue-500/20 text-blue-200 border border-blue-400/30",DELIVERED:"bg-emerald-500/20 text-emerald-200 border border-emerald-400/30",CANCELLED:"bg-rose-500/20 text-rose-200 border border-rose-400/30"},h={COMPLETED:"bg-emerald-500/10 text-emerald-200 border border-emerald-400/30",PENDING:"bg-amber-500/10 text-amber-200 border border-amber-400/30",FAILED:"bg-rose-500/10 text-rose-200 border border-rose-400/30"},u=e=>e?new Date(e).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"—";function b(){let e=(0,l.useParams)(),s=e?.id,{data:t,status:i}=(0,d.useSession)(),[b,g]=(0,a.useState)(null),[j,f]=(0,a.useState)(!0),[N,y]=(0,a.useState)(null),[v,w]=(0,a.useState)(!1),[P,k]=(0,a.useState)(""),[S,A]=(0,a.useState)(!1),[E,D]=(0,a.useState)(""),C=(0,x.d)(),L=async()=>{if(!P.trim()){D("Please enter your M-Pesa phone number");return}let e=(0,m.uE)(P);if(!(0,m.vy)(e)){D("Please enter a valid Kenyan phone number (e.g., 254712345678 or 0712345678)");return}w(!0),D("");try{let t=await fetch("/api/payments/mpesa/retry",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({orderId:b.id,phone:e})}),r=await t.json();if(r.success){let e=await fetch(`/api/orders/${s}`,{cache:"no-store"});if(e.ok){let s=await e.json();g(s)}A(!1),r.mock?C.warning(r.message):r.isSandbox?C.info(r.message):C.success(r.message)}else{let e=r.message||"Failed to retry payment. Please try again.";D(e),C.error(e)}}catch(e){console.error("Retry payment error:",e),D("Failed to retry payment. Please try again.")}finally{w(!1)}},I=(0,a.useMemo)(()=>b?{subtotal:b.subtotal,shipping:b.shipping,tax:b.tax,discount:b.discount,total:b.total}:{subtotal:0,shipping:0,tax:0,discount:0,total:0},[b]);return"loading"===i||j?(0,r.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-transparent",children:(0,r.jsx)(o.A,{size:"lg",color:"blue",text:"Loading order details"})}):t?N?(0,r.jsx)("div",{className:"min-h-screen bg-transparent flex items-center justify-center px-4",children:(0,r.jsxs)("div",{className:"max-w-lg w-full bg-slate-900 border border-slate-800 rounded-3xl p-10 text-center space-y-4",children:[(0,r.jsx)("p",{className:"text-xl font-semibold text-white",children:N}),(0,r.jsxs)("p",{className:"text-slate-400",children:["If this order should exist, contact support and share the order number ",s,"."]}),(0,r.jsx)(n(),{href:"/orders",className:"inline-flex justify-center px-6 py-3 rounded-2xl border border-slate-700 text-white hover:bg-slate-800",children:"Back to orders"})]})}):b?(0,r.jsx)("div",{className:"min-h-screen bg-transparent text-white",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-10 space-y-8",children:[(0,r.jsxs)("nav",{className:"text-sm text-slate-400 flex items-center gap-2",children:[(0,r.jsx)(n(),{href:"/",className:"hover:text-white",children:"Home"}),(0,r.jsx)("span",{children:"›"}),(0,r.jsx)(n(),{href:"/orders",className:"hover:text-white",children:"Orders"}),(0,r.jsx)("span",{children:"›"}),(0,r.jsx)("span",{className:"text-white font-medium",children:b.orderNumber})]}),(0,r.jsxs)("header",{className:"bg-slate-900 border border-slate-800 rounded-3xl p-8 space-y-4",children:[(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm uppercase tracking-[0.35em] text-slate-500",children:"Order"}),(0,r.jsx)("h1",{className:"text-4xl font-semibold mt-2",children:b.orderNumber}),(0,r.jsxs)("p",{className:"text-slate-400 mt-2",children:["Placed ",u(b.createdAt)]})]}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,r.jsx)("span",{className:`px-4 py-2 rounded-full text-xs font-semibold ${p[b.status]||"bg-slate-800 border border-slate-700"}`,children:b.status?b.status.toLowerCase():"Unknown"}),(0,r.jsxs)("span",{className:`px-4 py-2 rounded-full text-xs font-semibold ${h[b.paymentStatus]||"bg-slate-800 border border-slate-700"}`,children:["payment ",b.paymentStatus?b.paymentStatus.toLowerCase():"Unknown"]}),(0,r.jsx)("span",{className:"px-4 py-2 rounded-full border border-slate-700 text-sm font-semibold text-sky-200",children:(0,c.L)(b.total)})]})]}),(0,r.jsxs)("div",{className:"flex flex-wrap items-center gap-4 text-sm text-slate-400",children:[(0,r.jsxs)("div",{children:["Payment method: ",(0,r.jsx)("span",{className:"text-white font-medium",children:b.paymentMethod?.toUpperCase()||"—"})]}),b.trackingNumber&&(0,r.jsxs)("div",{children:["Tracking: ",(0,r.jsx)("span",{className:"font-mono text-slate-200",children:b.trackingNumber})]}),b.carrier&&(0,r.jsxs)("div",{children:["Carrier: ",(0,r.jsx)("span",{className:"text-slate-200",children:b.carrier})]})]})]}),(0,r.jsxs)("section",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,r.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,r.jsxs)("div",{className:"bg-slate-900 border border-slate-800 rounded-3xl p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Items"}),(0,r.jsx)("div",{className:"space-y-5",children:b.items.map(e=>(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsx)("div",{className:"w-20 h-20 bg-slate-800 rounded-2xl flex items-center justify-center overflow-hidden",children:e.product?.images?.[0]?.url?(0,r.jsx)("img",{src:e.product.images[0].url,alt:e.product.name,className:"w-full h-full object-cover"}):(0,r.jsx)("span",{className:"text-xs text-slate-500",children:"IMG"})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,r.jsx)("p",{className:"font-medium text-white line-clamp-2",children:e.product?.name||"Product removed"}),(0,r.jsxs)("p",{className:"text-sm text-slate-400",children:["Qty ",e.quantity]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("p",{className:"font-semibold text-white",children:(0,c.L)(Number(e.price)*e.quantity)}),(0,r.jsxs)("p",{className:"text-sm text-slate-400",children:[(0,c.L)(Number(e.price))," each"]})]})]},e.id))})]}),(0,r.jsxs)("div",{className:"bg-slate-900 border border-slate-800 rounded-3xl p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Timeline"}),(0,r.jsx)("ol",{className:"space-y-4",children:(function(e){let s=new Date(e.createdAt),t=new Date(s.getTime()+864e5),r=new Date(e.deliveredAt?e.deliveredAt:s.getTime()+2592e5);return[{status:"Order placed",description:"We received your order and confirmed payment.",timestamp:s,completed:!0},{status:"Processing",description:"Hardware is being prepared in our Nairobi warehouse.",timestamp:new Date(s.getTime()+72e5),completed:["PROCESSING","SHIPPED","DELIVERED"].includes(e.status)},{status:"Shipped",description:e.carrier?`Dispatched via ${e.carrier}.`:"On the way to the courier.",timestamp:t,completed:["SHIPPED","DELIVERED"].includes(e.status)},{status:"Delivered",description:"Handed over to you.",timestamp:r,completed:"DELIVERED"===e.status}]})(b).map(e=>(0,r.jsxs)("li",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:`w-3 h-3 rounded-full mt-1 ${e.completed?"bg-sky-400":"bg-slate-600"}`}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium text-white",children:e.status}),(0,r.jsx)("p",{className:"text-sm text-slate-400",children:e.description}),(0,r.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:u(e.timestamp)})]})]},e.status))})]})]}),(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"bg-slate-900 border border-slate-800 rounded-3xl p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Summary"}),(0,r.jsxs)("dl",{className:"space-y-3 text-sm text-slate-300",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("dt",{children:"Subtotal"}),(0,r.jsx)("dd",{children:(0,c.L)(I.subtotal)})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("dt",{children:"Shipping"}),(0,r.jsx)("dd",{children:(0,c.L)(I.shipping)})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("dt",{children:"Tax"}),(0,r.jsx)("dd",{children:(0,c.L)(I.tax)})]}),I.discount>0&&(0,r.jsxs)("div",{className:"flex justify-between text-rose-300",children:[(0,r.jsx)("dt",{children:"Discount"}),(0,r.jsxs)("dd",{children:["-",(0,c.L)(I.discount)]})]}),(0,r.jsxs)("div",{className:"flex justify-between pt-3 mt-3 border-t border-slate-800 text-base font-semibold text-white",children:[(0,r.jsx)("dt",{children:"Total"}),(0,r.jsx)("dd",{children:(0,c.L)(I.total)})]})]})]}),(0,r.jsxs)("div",{className:"bg-slate-900 border border-slate-800 rounded-3xl p-6 space-y-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Shipping"}),(0,r.jsx)("address",{className:"not-italic text-slate-300 text-sm",children:b.shippingAddress?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"text-white font-medium",children:b.shippingAddress?.fullName||`${b.shippingAddress?.firstName||""} ${b.shippingAddress?.lastName||""}`.trim()||"Recipient"}),(0,r.jsx)("p",{children:b.shippingAddress?.street||b.shippingAddress?.address1||""}),b.shippingAddress?.address2&&(0,r.jsx)("p",{children:b.shippingAddress.address2}),(0,r.jsxs)("p",{children:[b.shippingAddress?.city||"",b.shippingAddress?.city&&b.shippingAddress?.state?", ":"",b.shippingAddress?.state||""," ",b.shippingAddress?.postalCode||""]}),b.shippingAddress?.country&&(0,r.jsx)("p",{children:b.shippingAddress.country}),b.shippingAddress?.phone&&(0,r.jsx)("p",{className:"mt-2",children:b.shippingAddress.phone})]}):(0,r.jsx)("p",{className:"text-slate-500",children:"No shipping address attached."})})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Payment"}),(0,r.jsxs)("p",{className:"text-sm text-slate-300",children:["Reference: ",b.paymentReference||"—"]}),b.mpesaReceiptNumber&&(0,r.jsxs)("p",{className:"text-sm text-slate-300",children:["M-Pesa receipt: ",b.mpesaReceiptNumber]}),b.stripePaymentIntentId&&(0,r.jsxs)("p",{className:"text-sm text-slate-300",children:["Stripe intent: ",b.stripePaymentIntentId]}),"mpesa"===b.paymentMethod&&("PENDING"===b.paymentStatus||"FAILED"===b.paymentStatus)&&(0,r.jsx)("div",{className:"mt-4 pt-4 border-t border-slate-800",children:S?(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs font-medium text-slate-400 mb-1",children:"M-Pesa Phone Number"}),(0,r.jsx)("input",{type:"tel",value:P,onChange:e=>{k(e.target.value),D("")},onBlur:e=>{k((0,m.uE)(e.target.value))},placeholder:"254712345678 or 0712345678",className:`w-full px-3 py-2 bg-slate-800 border rounded-lg text-white placeholder-slate-500 focus:outline-none focus:ring-2 transition-all text-sm ${E?"border-rose-500 focus:ring-rose-500":"border-slate-600 focus:ring-emerald-500 focus:border-emerald-500"}`}),E&&(0,r.jsx)("p",{className:"mt-1 text-xs text-rose-400",children:E}),P&&!E&&(0,m.vy)(P)&&(0,r.jsxs)("p",{className:"mt-1 text-xs text-emerald-400 flex items-center gap-1",children:[(0,r.jsx)("svg",{className:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,m.o$)(P)]})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("button",{onClick:L,disabled:v||!P.trim(),className:"flex-1 px-4 py-2 rounded-2xl bg-gradient-to-r from-emerald-500 to-green-500 text-white text-sm font-semibold hover:opacity-90 transition disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:v?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.A,{size:"small",color:"white"}),"Sending..."]}):"Send STK Push"}),(0,r.jsx)("button",{onClick:()=>{A(!1),D("")},className:"px-4 py-2 rounded-2xl border border-slate-700 text-slate-300 hover:bg-slate-800 text-sm",children:"Cancel"})]})]}):(0,r.jsx)("button",{onClick:()=>A(!0),className:"w-full px-4 py-2 rounded-2xl bg-gradient-to-r from-emerald-500 to-green-500 text-white text-sm font-semibold hover:opacity-90 transition",children:"Retry M-Pesa Payment"})})]})]}),b.trackingNumber&&(0,r.jsxs)("div",{className:"bg-slate-900 border border-slate-800 rounded-3xl p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-3",children:"Package Tracking"}),(0,r.jsx)("p",{className:"text-sm text-slate-400 mb-4",children:"Track your order in real-time"}),(0,r.jsxs)(n(),{href:`/orders/${b.id}/track`,className:"w-full px-4 py-3 rounded-2xl bg-gradient-to-r from-sky-500 to-blue-500 text-white text-sm font-semibold hover:opacity-90 flex items-center justify-center gap-2",children:[(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Track Package"]}),b.carrier&&(0,r.jsxs)("p",{className:"text-xs text-slate-500 mt-2",children:["Carrier: ",b.carrier]})]}),(0,r.jsxs)("div",{className:"bg-slate-900 border border-slate-800 rounded-3xl p-6",children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-3",children:"Need help?"}),(0,r.jsxs)("p",{className:"text-sm text-slate-400 mb-4",children:["Contact concierge support and reference order ",b.orderNumber,"."]}),(0,r.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,r.jsx)("a",{href:"mailto:support@dilitechsolutions.com",className:"px-4 py-2 rounded-2xl border border-slate-700 text-white hover:bg-slate-800 text-sm",children:"Email support"}),(0,r.jsx)("a",{href:`https://wa.me/254700000000?text=Hi%20Dilitech,%20I%20need%20help%20with%20${b.orderNumber}`,target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2 rounded-2xl bg-gradient-to-r from-emerald-500 to-green-500 text-white text-sm text-center hover:opacity-90",children:"WhatsApp concierge"})]})]})]})]})]})}):null:(0,r.jsx)("div",{className:"min-h-screen bg-transparent flex items-center justify-center px-4",children:(0,r.jsxs)("div",{className:"max-w-lg w-full bg-slate-900 border border-slate-800 rounded-3xl p-10 text-center space-y-6",children:[(0,r.jsx)("h1",{className:"text-3xl font-semibold text-white",children:"Sign in to view this order"}),(0,r.jsx)("p",{className:"text-slate-400",children:"Orders are protected for your security. Sign in with the account that placed this purchase."}),(0,r.jsx)(n(),{href:"/auth/signin",className:"inline-flex justify-center px-6 py-3 rounded-2xl bg-gradient-to-r from-sky-500 to-blue-500 text-white font-semibold hover:opacity-90 transition",children:"Continue to sign in"})]})})}},42701:(e,s,t)=>{"use strict";t.d(s,{L:()=>r});let r=e=>new Intl.NumberFormat("en-KE",{style:"currency",currency:"KES",minimumFractionDigits:0}).format(Number(e)||0)},6775:(e,s,t)=>{"use strict";function r(e){if(!e)return"";let s=e.replace(/\D/g,"");if(s.startsWith("254"));else if(s.startsWith("0"))return"254"+s.substring(1);else if(9===s.length)return"254"+s;else if(10===s.length&&s.startsWith("7"))return"254"+s;return s}function a(e){let s=r(e);return/^2547\d{8}$/.test(s)}function i(e){let s=r(e);return 12===s.length&&s.startsWith("2547")?`${s.substring(0,3)} ${s.substring(3,4)} ${s.substring(4,7)} ${s.substring(7,10)}`:s}t.d(s,{o$:()=>i,uE:()=>r,vy:()=>a})},78215:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});let r=(0,t(46760).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/user/Desktop/RogueApe/work/jabistore/src/app/orders/[id]/page.js\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/user/Desktop/RogueApe/work/jabistore/src/app/orders/[id]/page.js","default")},70440:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>a});var r=t(88077);let a=async e=>[{type:"image/x-icon",sizes:"16x16",url:(0,r.fillMetadataSegment)(".",await e.params,"favicon.ico")+""}]}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[5994,2732,7254,8077,4880],()=>t(3692));module.exports=r})();